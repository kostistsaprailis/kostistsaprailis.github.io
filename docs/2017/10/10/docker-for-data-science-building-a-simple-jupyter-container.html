
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://tsaprailis.com/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://tsaprailis.com/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="https://tsaprailis.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://tsaprailis.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://tsaprailis.com/theme/font-awesome/css/solid.css">




    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  


 

<meta name="author" content="Kostis Tsaprailis" />
<meta name="description" content="This is the first post on a series covering my findings while exploring containers for Data Science projects." />
<meta name="keywords" content="docker, data science, devops">


  <meta property="og:site_name" content="Kostis Tsaprailis"/>
  <meta property="og:title" content="Docker for data science, building a simple jupyter container"/>
  <meta property="og:description" content="This is the first post on a series covering my findings while exploring containers for Data Science projects."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://tsaprailis.com/2017/10/10/docker-for-data-science-building-a-simple-jupyter-container.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2017-10-10 00:00:00+03:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://tsaprailis.com/author/kostis-tsaprailis.html">
  <meta property="article:section" content="tutorial"/>
  <meta property="article:tag" content="docker"/>
  <meta property="article:tag" content="data science"/>
  <meta property="article:tag" content="devops"/>
  <meta property="og:image" content="/images/profile.png">

  <title>Kostis Tsaprailis &ndash; Docker for data science, building a simple jupyter container</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="https://tsaprailis.com/">
        <img src="/images/profile.png" alt="" title="">
      </a>

      <h1>
        <a href="https://tsaprailis.com/"></a>
      </h1>

<p>Full Stack Breaker</p>


      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/ktsaprailis" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-github" href="https://github.com/kostistsaprailis/" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/konstantinostsaprailis/" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="docker-for-data-science-building-a-simple-jupyter-container">Docker for data science, building a simple jupyter container</h1>
    <p>
      Posted on Tue 10 October 2017 in <a href="https://tsaprailis.com/category/tutorial.html">tutorial</a>

    </p>
  </header>


  <div>
    <p>This is the first in a series of posts where I'll be noting down my findings while exploring Docker and how and if it can help for everything Data Science related. In this post I'll try to build a simple container that will have a jupyter notebook installed.</p>
<h3>What is Docker?</h3>
<p>From <a href="https://en.wikipedia.org/wiki/Docker_(software)">Wikipedia</a>:</p>
<blockquote>
<p>Docker is a software technology providing containers, promoted by the company Docker, Inc. Docker provides an additional layer of abstraction and automation of operating-system-level virtualization on Windows and Linux. Docker uses the resource isolation features of the Linux kernel such as cgroups and kernel namespaces, and a union-capable file system such as OverlayFS and others to allow independent "containers" to run within a single Linux instance, avoiding the overhead of starting and maintaining virtual machines (VMs).</p>
</blockquote>
<p>So Docker is a program that provides containers, and <a href="https://en.wikipedia.org/wiki/Operating-system-level_virtualization">containers</a> are one way of performing what is called Operating System Level Virtualization:</p>
<blockquote>
<p>Operating-system-level virtualization, also known as containerization, refers to an operating system feature in which the kernel allows the existence of multiple isolated user-space instances. Such instances, called containers, partitions, virtualization engines (VEs) or jails (FreeBSD jail or chroot jail), may look like real computers from the point of view of programs running in them. A computer program running on an ordinary person's computer's operating system can see all resources (connected devices, files and folders, network shares, CPU power, quantifiable hardware capabilities) of that computer. However, programs running inside a container can only see the container's contents and devices assigned to the container.</p>
</blockquote>
<p>This is achieved using the Linux <a href="https://en.wikipedia.org/wiki/Cgroups">cgroups</a> and <a href="https://en.wikipedia.org/wiki/Linux_namespaces">namespaces</a> feaures which respectively are described as:</p>
<blockquote>
<p>cgroups (abbreviated from control groups) is a Linux kernel feature that limits, accounts for, and isolates the resource usage (CPU, memory, disk I/O, network, etc.) of a collection of processes.
and
Namespaces are a feature of the Linux kernel that isolate and virtualize system resources of a collection of processes. Examples of resources that can be virtualized include process IDs, hostnames, user IDs, network access, interprocess communication, and filesystems. Namespaces are a fundamental aspect of containers on Linux.</p>
</blockquote>
<p>This means that docker is not the only way to create and use containers. Another similar software is <a href="https://github.com/rkt/rkt">rkt</a>. However since Docker is the dominant container technology I will explore this option for now.</p>
<h3>Getting started with Docker</h3>
<p>To use docker it needs to be installed on your system (duh). The official <a href="https://docs.docker.com/engine/installation/">instructions</a> pretty much cover anything, but there are two main points to notice:</p>
<ul>
<li>Docker is provided in the Community Edition and Enterprise Edition. For the majority of use cases the Community Edition is enough as it provides the whole container, orchecstration, networking and security functionality.</li>
<li>Docker is available for all 3 major OSs however since the container technology is native to Linux, the docker versions for Mac and Windows will use a Virtual Machine on top of which docker will run. This is mostly important when deploying the containers as if they are not deployed on a Linux machine docker, the Virtual Machine that is created to run docker will have a performance cost on the host machine where docker is installed.</li>
</ul>
<p>Once docker is installed open up a shell to confirm it:</p>
<div class="highlight"><pre><span></span><code>$ docker --version
Docker version <span class="m">17</span>.09.0-ce, build afdb6d4
</code></pre></div>

<p>And the typical hello world example is running a hello world container:</p>
<div class="highlight"><pre><span></span><code>$ docker run hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 <span class="m">1</span>. The Docker client contacted the Docker daemon.
 <span class="m">2</span>. The Docker daemon pulled the <span class="s2">&quot;hello-world&quot;</span> image from the Docker Hub.
 <span class="m">3</span>. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 <span class="m">4</span>. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://cloud.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/engine/userguide/
</code></pre></div>

<p>In the output of the command there's a nice high level explanation of what happened here. So to proceed I need a good tutorial.</p>
<p>Fortunately the official docker <a href="https://docs.docker.com/get-started/">guide</a> is such a tutorial for getting a feeling for how Docker works. I'll add here the bits that I found interesting while going through it.</p>
<p>First note to keep in mind is the difference between a Docker Image and a Docker Container:</p>
<blockquote>
<p>An image is a lightweight, stand-alone, executable package that includes everything needed to run a piece of software, including the code, a runtime, libraries, environment variables, and config files.</p>
<p>A container is a runtime instance of an image—what the image becomes in memory when actually executed. It runs completely isolated from the host environment by default, only accessing host files and ports if configured to do so.</p>
<p>Containers run apps natively on the host machine’s kernel. They have better performance characteristics than virtual machines that only get virtual access to host resources through a hypervisor. Containers can get native access, each one running in a discrete process, taking no more memory than any other executable.</p>
</blockquote>
<h3>Docker images</h3>
<p>So in order to run a container we need to have an image. But how are images created? This is where the Dockerfiles come in. Dockerfiles describe the way that an image is being build, in layers. Every instruction will build a new layer with the changes of that instruction.</p>
<p>Usually the first command in a dockerfile is a <code>FROM</code> command. This defines a base image upon which the current image will be expanded (as mentioned in layers). The command is followed by the image name, a colon and a tag which defines different versions of the image. From that point on the rest of the commands build upon this image, with pretty much every linux command. The available commands can be found [here]](https://docs.docker.com/engine/reference/builder/).</p>
<p>To find available base images the best place is the <a href="https://store.docker.com/">Docker store</a>. Most of the images there are free, however there are also paid ones. You can search and find an image containing pretty much every software package available including images for databases, webservers, messaging systems etc. You can also push your own images to the store for others to use.</p>
<p>For a simple example let's create an image that contains python3 and jupyter. I'll be using the ubuntu image as the base image here. Next we use the <code>RUN</code> command to execute the system update and installation of python3 and the pip package manager. The next layer installs jupyter. Then we add another layer which creates a new system user, another layer to change to this user with the <code>USER</code> command, and finally using the <code>ENTRYPOINT</code> command we will define the command to start jupyter (using the <code>--ip=*</code> param to allow incoming traffic to jupyter from any IP). By default the filename of a dockerfile is, well, <code>Dockerfile</code>. </p>
<div class="highlight"><pre><span></span><code># <span class="nv">Use</span> <span class="nv">the</span> <span class="nv">latest</span> <span class="nv">ubuntu</span> <span class="nv">image</span> <span class="nv">as</span> <span class="nv">base</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">new</span> <span class="nv">image</span>
# <span class="nv">ubuntu</span> <span class="nv">is</span> <span class="nv">the</span> <span class="nv">image</span> <span class="nv">name</span> <span class="nv">and</span> <span class="nv">latest</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">tag</span> <span class="nv">that</span> 
# <span class="nv">references</span> <span class="nv">a</span> <span class="nv">particular</span> <span class="nv">version</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">image</span>.
# <span class="nv">In</span> <span class="nv">this</span> <span class="nv">case</span> <span class="nv">latest</span> <span class="nv">is</span> <span class="nv">always</span> <span class="nv">the</span> <span class="nv">latest</span> <span class="nv">LTS</span> <span class="nv">image</span>
# <span class="nv">at</span> <span class="nv">the</span> <span class="nv">time</span> <span class="nv">of</span> <span class="nv">writing</span> <span class="nv">this</span>, <span class="nv">it</span><span class="s1">&#39;</span><span class="s">s 16.04.</span>
<span class="nv">FROM</span> <span class="nv">ubuntu</span>:<span class="nv">latest</span>

# <span class="nv">Run</span> <span class="nv">a</span> <span class="nv">system</span> <span class="nv">update</span> <span class="nv">to</span> <span class="nv">get</span> <span class="nv">it</span> <span class="nv">up</span> <span class="nv">to</span> <span class="nv">speed</span>
# <span class="k">Then</span> <span class="nv">install</span> <span class="nv">python3</span> <span class="nv">and</span> <span class="nv">pip3</span>
<span class="nv">RUN</span> <span class="nv">apt</span><span class="o">-</span><span class="nv">get</span> <span class="nv">update</span> <span class="o">&amp;&amp;</span> <span class="nv">apt</span><span class="o">-</span><span class="nv">get</span> <span class="nv">install</span> <span class="o">-</span><span class="nv">y</span> <span class="nv">python3</span> \
    <span class="nv">python3</span><span class="o">-</span><span class="nv">pip</span>

# <span class="nv">Install</span> <span class="nv">jupyter</span>
<span class="nv">RUN</span> <span class="nv">pip3</span> <span class="nv">install</span> <span class="nv">jupyter</span>

# <span class="nv">Create</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">system</span> <span class="nv">user</span>
<span class="nv">RUN</span> <span class="nv">useradd</span> <span class="o">-</span><span class="nv">ms</span> <span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">bash</span> <span class="nv">jupyter</span>

# <span class="nv">Change</span> <span class="nv">to</span> <span class="nv">this</span> <span class="nv">new</span> <span class="nv">user</span>
<span class="nv">USER</span> <span class="nv">jupyter</span>

# <span class="nv">Set</span> <span class="nv">the</span> <span class="nv">container</span> <span class="nv">working</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">user</span> <span class="nv">home</span> <span class="nv">folder</span>
<span class="nv">WORKDIR</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">jupyter</span>

# <span class="nv">Start</span> <span class="nv">the</span> <span class="nv">jupyter</span> <span class="nv">notebook</span>
<span class="nv">ENTRYPOINT</span> [<span class="s2">&quot;</span><span class="s">jupyter</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">notebook</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">--ip=*</span><span class="s2">&quot;</span>]
</code></pre></div>

<p>Now that we have the dockerfile ready let's build the image. Running the command <code>docker images</code> lists the available images in the system. The ubuntu base image is not in our local system so when we will build our own image, it will be downloaded.</p>
<div class="highlight"><pre><span></span><code>$ docker images
REPOSITORY                   TAG                                       IMAGE ID            CREATED             SIZE
hello-world                  latest                                    1815c82652c0        <span class="m">3</span> months ago        <span class="m">1</span>.84kB
</code></pre></div>

<p>So let's see how we build images. The basic command is <code>docker build</code> and the path to the dockerfile. Usually we also provide the <code>-t</code> param which defines the new image tag. You can find details regarding the docker build command <a href="https://docs.docker.com/engine/reference/commandline/build/">here</a>. Running the command produces the following output (it has been truncated):</p>
<div class="highlight"><pre><span></span><code>$ docker build . -t jupyter
Sending build context to Docker daemon   <span class="m">2</span>.56kB
Step <span class="m">1</span>/6 : FROM ubuntu:latest
 ---&gt; 2d696327ab2e
Step <span class="m">2</span>/6 : RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install -y python3     python3-pip
 ---&gt; Running <span class="k">in</span> bb404ad1f745
Get:1 http://security.ubuntu.com/ubuntu xenial-security InRelease <span class="o">[</span><span class="m">102</span> kB<span class="o">]</span>
Get:2 http://archive.ubuntu.com/ubuntu xenial InRelease <span class="o">[</span><span class="m">247</span> kB<span class="o">]</span>
Get:3 http://security.ubuntu.com/ubuntu xenial-security/universe Sources <span class="o">[</span><span class="m">49</span>.7 kB<span class="o">]</span>
Get:4 http://archive.ubuntu.com/ubuntu xenial-updates InRelease <span class="o">[</span><span class="m">102</span> kB<span class="o">]</span>
Get:5 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages <span class="o">[</span><span class="m">456</span> kB<span class="o">]</span>
...
...
...
Removing intermediate container 4fc4f28aa4a7
Step <span class="m">4</span>/6 : RUN useradd -ms /bin/bash jupyter
 ---&gt; Running <span class="k">in</span> 1dc139392c0d
 ---&gt; 61a9386d2b4d
Removing intermediate container 1dc139392c0d
Step <span class="m">5</span>/6 : USER jupyter
 ---&gt; Running <span class="k">in</span> a3d0480587cd
 ---&gt; 2516f84b585d
Removing intermediate container a3d0480587cd
Step <span class="m">6</span>/6 : ENTRYPOINT jupyter notebook --ip<span class="o">=</span>*
 ---&gt; Running <span class="k">in</span> 0eceeb09bb7d
 ---&gt; ff2f03f5aaea
Removing intermediate container 0eceeb09bb7d
Successfully built ff2f03f5aaea
Successfully tagged jupyter:latest
</code></pre></div>

<p>Once it is finished we can run again the <code>docker images</code> command to see the newly created image:</p>
<div class="highlight"><pre><span></span><code>$ docker images
REPOSITORY                   TAG                                       IMAGE ID            CREATED              SIZE
jupyter                      latest                                    ff2f03f5aaea        About a minute ago   541MB
ubuntu                       latest                                    2d696327ab2e        <span class="m">2</span> weeks ago          122MB
hello-world                  latest                                    1815c82652c0        <span class="m">3</span> months ago         <span class="m">1</span>.84kB
</code></pre></div>

<p>Now we have our own brand new image to use. As mentioned before we can push this image to the store for others to use. Alternatively we can use a private docker registry (all the major cloud providers have similar services) if the image contains proprietary code, passwords, ssh keys etc. For all commercial applications, all companies use a private registry to privately store the images.</p>
<h3>Docker containers</h3>
<p>The main thing we do with an image is run a container. This is done with the <code>docker run</code> command. The full details for how to use the command can be found <a href="https://docs.docker.com/engine/reference/run/">here</a>. For the image we have beed building here we can run <code>docker run -it -p 8888:8888 ff2f03f5aaea /bin/bash</code> where <code>ff2f03f5aaea</code> is the image id that we got from the <code>docker images</code> command.</p>
<div class="highlight"><pre><span></span><code>$ docker run -it -p <span class="m">8888</span>:8888 ff2f03f5aaea /bin/bash
<span class="o">[</span>I <span class="m">20</span>:47:25.881 NotebookApp<span class="o">]</span> Writing notebook server cookie secret to /home/jupyter/.local/share/jupyter/runtime/notebook_cookie_secret
<span class="o">[</span>W <span class="m">20</span>:47:25.897 NotebookApp<span class="o">]</span> WARNING: The notebook server is listening on all IP addresses and not using encryption. This is not recommended.
<span class="o">[</span>I <span class="m">20</span>:47:25.904 NotebookApp<span class="o">]</span> Serving notebooks from <span class="nb">local</span> directory: /bin
<span class="o">[</span>I <span class="m">20</span>:47:25.904 NotebookApp<span class="o">]</span> <span class="m">0</span> active kernels
<span class="o">[</span>I <span class="m">20</span>:47:25.904 NotebookApp<span class="o">]</span> The Jupyter Notebook is running at:
<span class="o">[</span>I <span class="m">20</span>:47:25.905 NotebookApp<span class="o">]</span> http://<span class="o">[</span>all ip addresses on your system<span class="o">]</span>:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
<span class="o">[</span>I <span class="m">20</span>:47:25.905 NotebookApp<span class="o">]</span> Use Control-C to stop this server and shut down all kernels <span class="o">(</span>twice to skip confirmation<span class="o">)</span>.
<span class="o">[</span>W <span class="m">20</span>:47:25.905 NotebookApp<span class="o">]</span> No web browser found: could not locate runnable browser.
<span class="o">[</span>C <span class="m">20</span>:47:25.906 NotebookApp<span class="o">]</span> 

    Copy/paste this URL into your browser when you connect <span class="k">for</span> the first time,
    to login with a token:
        http://localhost:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</code></pre></div>

<p>If you open a browser window and go to the above url you'll see the notebook live. It's a new clean environment that we can shape as we like and destroy once we are done.</p>
<p>Going to a new terminal and run the <code>docker ps</code> command (which lists the running containers) we can see our container! Notice the <code>-p 8888:8888</code> parameter. This maps the container's inner port to the host machine's port. This is done so that we can access the jupyter notebook running inside the container from our machine. By default everything is isolated inside the container and we need to manually export any resources that need to be exposed as to be accessed.</p>
<div class="highlight"><pre><span></span><code>$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
911acd30ed36        ff2f03f5aaea        <span class="s2">&quot;jupyter notebook ...&quot;</span>   <span class="m">18</span> minutes ago      Up <span class="m">18</span> minutes       <span class="m">0</span>.0.0.0:8888-&gt;8888/tcp   sleepy_hugle
</code></pre></div>

<p>Furthermore the way we ran the container above though we need to keep the terminal open otherwise the container will stop. Typing <code>ctrl+c</code> to kill the container we can see that there's no longer any container:</p>
<div class="highlight"><pre><span></span><code>$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</code></pre></div>

<p>To work around this issue we can add the <code>-d</code> parameter when we run a container which detaches it from the terminal so that it runs in the background even after the terminal has closed.</p>
<div class="highlight"><pre><span></span><code>$ docker run -d -p <span class="m">8888</span>:8888 ff2f03f5aaea
98890a46a5c2375b8aa3a36111ceee941992391b4c19f2878d9906e4ff5ce699
</code></pre></div>

<p>In this case we get the terminal back on the host system which means it has not been attached to the container. However to confirm that the container is running let's run the <code>docker ps</code> command again:</p>
<div class="highlight"><pre><span></span><code>$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
98890a46a5c2        ff2f03f5aaea        <span class="s2">&quot;jupyter notebook ...&quot;</span>   <span class="m">40</span> seconds ago      Up <span class="m">38</span> seconds       <span class="m">0</span>.0.0.0:8888-&gt;8888/tcp   hungry_euclid
</code></pre></div>

<p>It is indeed running. But how do we get the url from Jupyter? We use another docker command, <code>docker logs &lt;container&gt;</code>. Notice that instead of the container id we can also use the container name obtained above.</p>
<div class="highlight"><pre><span></span><code>$ docker logs hungry_euclid
<span class="o">[</span>I <span class="m">19</span>:38:32.023 NotebookApp<span class="o">]</span> Writing notebook server cookie secret to /home/jupyter/.local/share/jupyter/runtime/notebook_cookie_secret
<span class="o">[</span>W <span class="m">19</span>:38:32.059 NotebookApp<span class="o">]</span> WARNING: The notebook server is listening on all IP addresses and not using encryption. This is not recommended.
<span class="o">[</span>I <span class="m">19</span>:38:32.075 NotebookApp<span class="o">]</span> Serving notebooks from <span class="nb">local</span> directory: /
<span class="o">[</span>I <span class="m">19</span>:38:32.075 NotebookApp<span class="o">]</span> <span class="m">0</span> active kernels
<span class="o">[</span>I <span class="m">19</span>:38:32.076 NotebookApp<span class="o">]</span> The Jupyter Notebook is running at:
<span class="o">[</span>I <span class="m">19</span>:38:32.076 NotebookApp<span class="o">]</span> http://<span class="o">[</span>all ip addresses on your system<span class="o">]</span>:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
<span class="o">[</span>I <span class="m">19</span>:38:32.076 NotebookApp<span class="o">]</span> Use Control-C to stop this server and shut down all kernels <span class="o">(</span>twice to skip confirmation<span class="o">)</span>.
<span class="o">[</span>W <span class="m">19</span>:38:32.076 NotebookApp<span class="o">]</span> No web browser found: could not locate runnable browser.
<span class="o">[</span>C <span class="m">19</span>:38:32.077 NotebookApp<span class="o">]</span> 

    Copy/paste this URL into your browser when you connect <span class="k">for</span> the first time,
    to login with a token:
        http://localhost:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</code></pre></div>

<p>Finally to stop the container we need to manually do it by running the command <code>docker stop &lt;container id&gt;</code>:</p>
<div class="highlight"><pre><span></span><code>$ docker stop hungry_euclid
hungry_euclid
</code></pre></div>

<p>And we can see that indeed there are no longer any containers running:</p>
<div class="highlight"><pre><span></span><code>$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</code></pre></div>

<h3>Removing containers &amp; images</h3>
<p>One last thing that is useful to know is how to remove containers and images. The commands respectively are <code>docker rm &lt;container&gt;</code> and <code>docker rmi &lt;image&gt;</code>. The way to find containers that are stopped is <code>docker ps -a</code>.</p>
<div class="highlight"><pre><span></span><code>$ docker ps -a
98890a46a5c2        ff2f03f5aaea                                 <span class="s2">&quot;jupyter notebook ...&quot;</span>   <span class="m">10</span> minutes ago        Exited <span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="m">12</span> minutes ago                             hungry_euclid
$ docker rm hungry_euclid
hungry_euclid
</code></pre></div>

<p>Now to remove the image we have built:</p>
<div class="highlight"><pre><span></span><code>$ docker images
REPOSITORY                   TAG                                       IMAGE ID            CREATED             SIZE
jupyter                      latest                                    ff2f03f5aaea        <span class="m">2</span> hours ago        541MB
ubuntu                       latest                                    2d696327ab2e        <span class="m">3</span> weeks ago         122MB
hello-world                  latest                                    1815c82652c0        <span class="m">3</span> months ago        <span class="m">1</span>.84kB
$ docker rmi ff2f03f5aaea
Untagged: jupyter:latest
Deleted: sha256:ff2f03f5aaea4ce5f2acd36d7ab2fde0337fa34d2921aaac3e51630778f4bba1
Deleted: sha256:2516f84b585d62c71514ce373baa93f6842c50573eb160983793b63b45a16bbe
Deleted: sha256:61a9386d2b4d569787f53b02b93060ee8bb25cf3b21e833e179dda8cfc395a9c
Deleted: sha256:4c69651b94bbbca80e6521cc4576ccf5ff5cfa4a10dc1acae87a047b91d0001a
Deleted: sha256:e5c0bb29999d46880dbe106099f4f1cc265227cf5b16a29a98983ace01db3d97
Deleted: sha256:5fa718810d8afb400449e9967c1f0fc46bbe2f4273b67e4e61a18f159e859dcb
Deleted: sha256:3d5ec8b404c085bc7548a32d8077e5ec58e25e1059e78c88be5effab9414932b
Deleted: sha256:b55b2ae6bd8065f43e39f179773f82e0bb1df302162796bddd48cb606e6e6c1b
</code></pre></div>

<h3>Docker Storage (Update)</h3>
<p>User <a href="https://www.reddit.com/user/gvkalra">gvkalra</a> on <a href="https://www.reddit.com/r/learnmachinelearning/comments/75rthw/introduction_to_docker_for_data_science_building/">Reddit</a> noted the importance of mounted storage so I think this needs to be included here as well.
So the basic question reagarding this issue is that as mentioned everything about a container is ephemeral, that's the whole point of creating a detached, clean environment in the first place. Then what happens if we have data that we need to persist after the container has been killed? Data could be either code or perhaps the output of calculations that we have performed.
Docker solves this issue by the use of three persistent storage <a href="https://docs.docker.com/engine/admin/volumes/">techniques</a>. The techniques are <a href="https://docs.docker.com/engine/admin/volumes/volumes/">volumes</a>, <a href="https://docs.docker.com/engine/admin/volumes/bind-mounts/">bind mounts</a> and <a href="https://docs.docker.com/engine/admin/volumes/tmpfs/">tmpfs</a>. Each of these have their specific use cases.</p>
<h4>Volumes</h4>
<p>The first, most common and preferred one is volumes. These are isolated spaces in the docker host which are stored under <code>/var/lib/docker/volumes</code>. The volume is mounted when a container is ran and mapped to a location on the container filesystem. Whatever is written in that location by the container will persist after the container has been killed. It's also useful to know that volumes can be shared across many different containers.
Volumes can be created either explicitly and independent of any container with a standalone command, or they can be created if they passed as a docker run parameter.
To create a new volume run the command <code>docker volume create jupyter_store</code> where <code>jupyter_store</code> should be whatever name the new volume should have. Running <code>docker volume ls</code> lists all the available volumes:</p>
<div class="highlight"><pre><span></span><code>$ docker volume ls
DRIVER              VOLUME NAME
<span class="nb">local</span>               jupyter_store
</code></pre></div>

<p>To get additional information for our new volume we use <code>docker volume inspect jupyter_store</code>:</p>
<div class="highlight"><pre><span></span><code>$ docker volume inspect jupyter_store
<span class="o">[</span>
    <span class="o">{</span>
        <span class="s2">&quot;CreatedAt&quot;</span>: <span class="s2">&quot;2017-10-21T15:36:23+03:00&quot;</span>,
        <span class="s2">&quot;Driver&quot;</span>: <span class="s2">&quot;local&quot;</span>,
        <span class="s2">&quot;Labels&quot;</span>: <span class="o">{}</span>,
        <span class="s2">&quot;Mountpoint&quot;</span>: <span class="s2">&quot;/var/lib/docker/volumes/jupyter_store/_data&quot;</span>,
        <span class="s2">&quot;Name&quot;</span>: <span class="s2">&quot;jupyter_store&quot;</span>,
        <span class="s2">&quot;Options&quot;</span>: <span class="o">{}</span>,
        <span class="s2">&quot;Scope&quot;</span>: <span class="s2">&quot;local&quot;</span>
    <span class="o">}</span>
<span class="o">]</span>
</code></pre></div>

<p>So now we have a volume that we can use. Let's start a new container and connect to jupyter:</p>
<div class="highlight"><pre><span></span><code>$ docker run -d -p <span class="m">8888</span>:8888 -v jupyter_store:/home/jupyter d189bcaf0613
2bafcd956a5f04039b81a4c1dbb3b9b6375b858d68ab9930c5a9c505d79ddca5
$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
2bafcd956a5f        d189bcaf0613        <span class="s2">&quot;jupyter notebook ...&quot;</span>   <span class="m">7</span> seconds ago       Up <span class="m">5</span> seconds        <span class="m">0</span>.0.0.0:8888-&gt;8888/tcp   elastic_curran
$ docker logs elastic_curran
<span class="o">[</span>I <span class="m">16</span>:29:26.100 NotebookApp<span class="o">]</span> Writing notebook server cookie secret to /home/jupyter/.local/share/jupyter/runtime/notebook_cookie_secret
<span class="o">[</span>W <span class="m">16</span>:29:26.118 NotebookApp<span class="o">]</span> WARNING: The notebook server is listening on all IP addresses and not using encryption. This is not recommended.
<span class="o">[</span>I <span class="m">16</span>:29:26.124 NotebookApp<span class="o">]</span> Serving notebooks from <span class="nb">local</span> directory: /home/jupyter
<span class="o">[</span>I <span class="m">16</span>:29:26.124 NotebookApp<span class="o">]</span> <span class="m">0</span> active kernels
<span class="o">[</span>I <span class="m">16</span>:29:26.124 NotebookApp<span class="o">]</span> The Jupyter Notebook is running at:
<span class="o">[</span>I <span class="m">16</span>:29:26.125 NotebookApp<span class="o">]</span> http://<span class="o">[</span>all ip addresses on your system<span class="o">]</span>:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
<span class="o">[</span>I <span class="m">16</span>:29:26.125 NotebookApp<span class="o">]</span> Use Control-C to stop this server and shut down all kernels <span class="o">(</span>twice to skip confirmation<span class="o">)</span>.
<span class="o">[</span>W <span class="m">16</span>:29:26.125 NotebookApp<span class="o">]</span> No web browser found: could not locate runnable browser.
<span class="o">[</span>C <span class="m">16</span>:29:26.125 NotebookApp<span class="o">]</span> 

    Copy/paste this URL into your browser when you connect <span class="k">for</span> the first time,
    to login with a token:
        http://localhost:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</code></pre></div>

<p>Now let's create a new notebook called <code>test</code> and save it locally (on the container). Then I will stop the container and remove it altogether:</p>
<div class="highlight"><pre><span></span><code>$ docker stop elastic_curran
elastic_curran
$ docker rm elastic_curran
elastic_curran
</code></pre></div>

<p>Then I will create a new container and connect to jupyter:</p>
<div class="highlight"><pre><span></span><code>$ docker run -d -p <span class="m">8888</span>:8888 -v jupyter_store:/home/jupyter d189bcaf0613
99d953e9ea5960e88e7c756275a3f0746ebac55fce566e2f3bc7e0d6e4a671be
$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
99d953e9ea59        d189bcaf0613        <span class="s2">&quot;jupyter notebook ...&quot;</span>   <span class="m">12</span> seconds ago      Up <span class="m">10</span> seconds       <span class="m">0</span>.0.0.0:8888-&gt;8888/tcp   suspicious_saha
$ docker logs suspicious_saha 
<span class="o">[</span>W <span class="m">16</span>:32:04.903 NotebookApp<span class="o">]</span> WARNING: The notebook server is listening on all IP addresses and not using encryption. This is not recommended.
<span class="o">[</span>I <span class="m">16</span>:32:04.910 NotebookApp<span class="o">]</span> Serving notebooks from <span class="nb">local</span> directory: /home/jupyter
<span class="o">[</span>I <span class="m">16</span>:32:04.910 NotebookApp<span class="o">]</span> <span class="m">0</span> active kernels
<span class="o">[</span>I <span class="m">16</span>:32:04.910 NotebookApp<span class="o">]</span> The Jupyter Notebook is running at:
<span class="o">[</span>I <span class="m">16</span>:32:04.910 NotebookApp<span class="o">]</span> http://<span class="o">[</span>all ip addresses on your system<span class="o">]</span>:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
<span class="o">[</span>I <span class="m">16</span>:32:04.910 NotebookApp<span class="o">]</span> Use Control-C to stop this server and shut down all kernels <span class="o">(</span>twice to skip confirmation<span class="o">)</span>.
<span class="o">[</span>W <span class="m">16</span>:32:04.910 NotebookApp<span class="o">]</span> No web browser found: could not locate runnable browser.
<span class="o">[</span>C <span class="m">16</span>:32:04.910 NotebookApp<span class="o">]</span> 

    Copy/paste this URL into your browser when you connect <span class="k">for</span> the first time,
    to login with a token:
        http://localhost:8888/?token<span class="o">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</code></pre></div>

<p>We can see that the previously created notebook is available. The fact that volumes are independent of the containers means that we can delete containers, create containers from new images altogether without having to worry about our data getting corrupted. Obviously this is also applicable with containers that contain databases. </p>
<p>Finally let's explore the folder that was assigned to this volume. Listing the folder files (we need sudo to access it because permissions to the docker volumes folder are restricted for the normal linux users):</p>
<div class="highlight"><pre><span></span><code>$ sudo ls /var/lib/docker/volumes/jupyter_store/_data
test.ipynb
</code></pre></div>

<p>Our jupyter notebook is saved there as expected. To get more details about the intricacies of volumes please refer to the full guide on the docker site <a href="https://docs.docker.com/engine/admin/volumes/volumes/">here</a>. 
Before we move on I should note the command to remove volumes is:</p>
<div class="highlight"><pre><span></span><code>$ docker volume rm jupyter_store
</code></pre></div>

<h4>Bind Mount</h4>
<p>The second way to achieve data persistence on a container is using bind mounts. This is a pretty similar technique which instead of creating an isolated storage space for the containers, instead uses a folder from the docker host machine that is specified when we start a container. For example to use the current working directory we should run:</p>
<div class="highlight"><pre><span></span><code>$ docker run -d -p <span class="m">8888</span>:8888 -v <span class="s2">&quot;</span><span class="k">$(</span>PWD<span class="k">)</span><span class="s2">&quot;</span>:/home/jupyter d189bcaf0613
</code></pre></div>

<p>or if we wanted to mount the <code>/tmp/source/input</code> folder (the folder should exist on the docker host machine) we would use: </p>
<div class="highlight"><pre><span></span><code>$ docker run -d -p <span class="m">8888</span>:8888 -v /tmp/source/input/:/home/jupyter d189bcaf0613
</code></pre></div>

<p>Obviously since these folders are not restricted to be used by docker alone, run the risk of being overwritten by other processes running on the docker host and hence this method of using persistence is not preferred except in cases where we have sensitive data on the docker host that we don't want to include on the docker image, but we do need on the container, like configuration files or password data. To find out more about bind mounts please refer again to the docker site <a href="https://docs.docker.com/engine/admin/volumes/bind-mounts">page</a>.</p>
<h4>tmpfs</h4>
<p>The last way we can use persistence is with tmpfs. This is really a pseudo-persistence technique since we are using the docker host machine memory to create a mount point. This is useful in cases where we want to store data on the container just for lifecycle of the container but we also don't want to keep these on the container memory. 
To use this mount we run a container with the <code>--tmpfs</code> param instead of <code>-v</code> and provide the container mount point:</p>
<div class="highlight"><pre><span></span><code>$ docker run -d -p <span class="m">8888</span>:8888 -tmpfs /home/jupyter d189bcaf0613
</code></pre></div>

<p>This is really a niche use case, if you want find out more about it check the <a href="https://docs.docker.com/engine/admin/volumes/tmpfs">docs</a>.</p>
<h3>Conclusion</h3>
<p>This was a small introduction into the docker basics: images and containers. The next post in the series will cover a multi-container system, where containers really shine.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://tsaprailis.com/tag/docker.html">docker</a>
      <a href="https://tsaprailis.com/tag/data-science.html">data science</a>
      <a href="https://tsaprailis.com/tag/devops.html">devops</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Kostis Tsaprailis ",
  "url" : "https://tsaprailis.com",
  "image": "/images/profile.png",
  "description": ""
}
</script>

</body>
</html>